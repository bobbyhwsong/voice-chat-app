# 🏥 의료 진료 연습 시스템

AI 의사와의 음성 기반 진료 대화 연습을 위한 연구 시스템입니다.

## ✨ 주요 기능

### 🎯 음성 기반 진료 시스템
- **음성 인식 (Speech-to-Text)**: 마이크로 증상 설명
- **음성 합성 (Text-to-Speech)**: AI 의사 응답을 음성으로 들려줌
- **50대 남성 AI 의사**: 경험 많은 내과 의사 역할
- **실시간 대화**: 자연스러운 진료 대화 연습

### 📊 연구 데이터 관리
- **사용자별 폴더 구조**: 참여자 ID별로 독립적인 폴더 생성
- **증상 정보 수집**: 첫 페이지에서 현재 증상 상세 설명 입력
- **자동 로그 기록**: 모든 대화가 사용자별 폴더에 JSON 파일로 저장
- **음성 파일 관리**: 사용자별 폴더에 음성 파일 저장

### 🎨 직관적인 사용자 인터페이스
- **4단계 흐름**: 연구 설명 → 증상 입력 → 가이드라인 → 진료 연습
- **반응형 디자인**: 모바일/데스크톱 모두 지원
- **확인 창**: 중요한 작업 시 사용자 확인
- **치트시트 팝업**: 완료 시 격려 메시지 표시

## 🚀 사용법

### 1. OpenAI API 키 설정

LLM 기능을 사용하려면 OpenAI API 키가 필요합니다:

```bash
# 환경변수로 설정
export OPENAI_API_KEY='your-api-key-here'

# 또는 app.py 파일에서 직접 설정
```

### 2. 서버에서 서비스 시작

#### 방법 1: 스크립트 사용 (권장)
```bash
# 프로젝트 디렉토리로 이동
cd /home/hyungwoo/nk

# LLM 서버 시작
./start_llm_server.sh

# 웹 서버 시작 (새 터미널에서)
./start_server.sh
```

#### 방법 2: 직접 실행
```bash
# 프로젝트 디렉토리로 이동
cd /home/hyungwoo/nk

# LLM 서버 시작 (5000번 포트)
python app.py &

# 웹 서버 시작 (5090번 포트)
/usr/bin/python3 -m http.server 5090 --bind 0.0.0.0
```

### 3. 로컬에서 SSH 포트 포워딩

로컬 컴퓨터에서 SSH 연결:
```bash
ssh -L 5090:localhost:5090 -p 2211 hyungwoo@147.47.123.184
```

### 4. 브라우저에서 접속 및 사용

SSH 연결 후 브라우저에서:
```
http://localhost:5090
```

### 5. 시스템 사용 흐름

#### 1단계: 연구 설명 및 로그인 (`index.html`)
- 연구 목적 및 참여 안내
- 참여자 정보 입력 (ID, 현재 증상 설명)
- 연구 참여 동의
- **새로운 기능**: 현재 아픈 증상 상세 설명 입력

#### 2단계: 진료 가이드라인 (`guideline.html`)
- **환자 입장에서 꼭 말해야 하는 것** 가이드라인
- **진료과정 중에 꼭 들어야 하는 것** 체크리스트
- 효과적인 진료 대화 팁
- 주의사항 안내

#### 3단계: 진료 연습 (`chat.html`)
- 음성 또는 텍스트로 증상 설명
- AI 의사와의 진료 대화
- 진료 세션 초기화 (확인 창 포함)

#### 4단계: 피드백 및 치트시트 (`feedback.html`, `cheatsheet.html`)
- 진료 대화 평가 및 피드백
- 맞춤형 치트시트 생성
- **새로운 기능**: 치트시트 완료 시 "수고했습니다!" 팝업

### 6. 진료 연습 사용법

#### 음성 입력 사용
1. 🎤 **증상 음성 입력** 버튼 클릭
2. 마이크 권한 허용
3. 증상을 말하기 시작
4. 인식 완료 후 자동으로 텍스트 입력

#### 텍스트 입력 사용
1. 입력창에 증상이나 질문 입력
2. **전송** 버튼 클릭 또는 Enter 키

#### 추가 기능
- **진료 세션 초기화**: 확인 창과 함께 대화 초기화
- **대화 로그 보기**: 참여자별 대화 기록 확인
- **치트시트 생성**: 대화 내용 기반 맞춤형 가이드 생성

## 🔴 서버 관리

### 서버 시작
```bash
# LLM 서버 시작
./start_llm_server.sh

# 웹 서버 시작 (새 터미널에서)
./start_server.sh
```

### 서버 종료
```bash
# LLM 서버 종료
pkill -f "python.*app.py"

# 웹 서버 종료
pkill -f "http.server"

# 모든 서버 종료
pkill -f "python.*app.py" && pkill -f "http.server"
```

### 서버 상태 확인
```bash
# LLM 서버 확인 (5000번 포트)
netstat -tlnp | grep :5000

# 웹 서버 확인 (5090번 포트)
netstat -tlnp | grep :5090

# 프로세스 확인
ps aux | grep "python.*app.py"
ps aux | grep "http.server"
```

### 서버 재시작
```bash
# 모든 서버 종료 후 재시작
pkill -f "python.*app.py" && pkill -f "http.server"
./start_llm_server.sh
./start_server.sh
```

## 🛠️ 기술 스택

### 프론트엔드
- **HTML5**: 웹 표준 마크업
- **CSS3**: 모던한 UI/UX 디자인
- **JavaScript ES6+**: 클래스 기반 구조
- **Web Speech API**: 
  - `SpeechRecognition`: 음성 인식
  - `SpeechSynthesis`: 음성 합성 (fallback)
- **ElevenLabs API**: 고품질 음성 합성

### 백엔드
- **Flask**: Python 웹 프레임워크
- **OpenAI API**: GPT-3.5-turbo 모델 (50대 남성 의사 역할)
- **CORS**: 크로스 오리진 리소스 공유
- **JSON 로깅**: 사용자별 대화 기록 저장

## 📋 브라우저 호환성

### 지원 브라우저
- ✅ Chrome 25+
- ✅ Edge 79+
- ✅ Safari 14.1+
- ✅ Firefox (제한적 지원)

### 주의사항
- HTTPS 환경에서만 음성 인식 기능 사용 가능
- 일부 브라우저에서는 추가 설정이 필요할 수 있음

## 🎨 UI/UX 특징

- **반응형 디자인**: 모바일/데스크톱 모두 지원
- **모던한 디자인**: 그라데이션과 그림자 효과
- **애니메이션**: 부드러운 전환 효과
- **접근성**: 키보드 네비게이션 지원
- **팝업 시스템**: 완료 시 격려 메시지 표시

## 🔧 시스템 특징

### AI 의사 설정
- **50대 남성 의사**: 경험 많은 내과 의사 역할
- **직설적 성격**: 친근하면서도 전문적인 태도
- **핵심 진료**: 불필요한 설명보다는 핵심 전달
- **의료 전문성**: 증상 문진, 진찰, 진단, 처방 등 의료 과정 지원

### 음성 시스템
- **ElevenLabs TTS**: 고품질 50대 남성 음성
- **Fallback TTS**: 브라우저 기본 음성 합성
- **음성 인식**: 한국어 음성 인식 지원

### 데이터 관리
- **사용자별 폴더 구조**: `logs/사용자ID/` 형태로 독립적인 저장 공간
- **증상 정보 저장**: 사용자별 `user_info.json`에 증상 데이터 저장
- **대화 로그**: 사용자별 폴더에 `medical_conversation_YYYYMMDD.json` 저장
- **음성 파일**: 사용자별 폴더에 `audio_YYYYMMDD_HHMMSS.mp3` 저장
- **피드백 로그**: 사용자별 폴더에 `feedback_YYYYMMDD_HHMMSS.json` 저장
- **자동 저장**: 모든 데이터가 사용자별로 자동 분류 저장

## 📁 파일 구조

```
medical-practice-system/
├── index.html              # 연구 설명 및 로그인 페이지 (증상 입력 포함)
├── guideline.html          # 진료 가이드라인 페이지
├── guideline-style.css     # 가이드라인 페이지 스타일
├── guideline.js            # 가이드라인 페이지 로직
├── chat.html               # 진료 연습 페이지
├── style.css               # 진료 연습 페이지 스타일
├── script.js               # 진료 연습 페이지 로직
├── retry.html              # 재연습 페이지
├── retry-style.css         # 재연습 페이지 스타일
├── retry.js                # 재연습 페이지 로직
├── feedback.html           # 피드백 페이지
├── feedback-style.css      # 피드백 페이지 스타일
├── feedback.js             # 피드백 페이지 로직
├── cheatsheet.html         # 치트시트 페이지
├── cheatsheet-style.css    # 치트시트 페이지 스타일
├── cheatsheet.js           # 치트시트 페이지 로직
├── app.py                  # LLM 백엔드 서버
├── requirements.txt         # Python 패키지 의존성
├── start_server.sh         # 웹 서버 시작 스크립트
├── start_llm_server.sh     # LLM 서버 시작 스크립트
├── logs/                   # 대화 로그 저장 디렉토리
│   ├── P001/              # 사용자별 폴더
│   │   ├── user_info.json # 사용자 정보 및 증상
│   │   ├── medical_conversation_20240801.json
│   │   ├── audio_20240801_143022.mp3
│   │   └── feedback_20240801_143022.json
│   ├── P002/
│   │   ├── user_info.json
│   │   ├── medical_conversation_20240801.json
│   │   ├── audio_20240801_143045.mp3
│   │   └── feedback_20240801_143045.json
│   └── ...
└── README.md               # 프로젝트 설명서
```

## 🐛 문제 해결

### 음성 인식이 작동하지 않는 경우
1. 브라우저가 Web Speech API를 지원하는지 확인
2. HTTPS 환경에서 실행 중인지 확인
3. 마이크 권한이 허용되었는지 확인
4. 브라우저 콘솔에서 오류 메시지 확인

### 음성 합성이 작동하지 않는 경우
1. 브라우저가 Speech Synthesis를 지원하는지 확인
2. 음성 설정에서 다른 음성 선택
3. 볼륨이 켜져 있는지 확인

### 서버 연결 오류
1. 서버가 실행 중인지 확인 (`netstat -tlnp | grep :5000`)
2. 방화벽 설정 확인
3. 포트 포워딩이 올바르게 설정되었는지 확인

## 🔮 향후 개선 계획

- [x] 사용자별 로그 분리
- [x] 진료 세션 초기화 확인 창
- [x] 4단계 사용자 흐름 구현
- [x] 증상 정보 수집 기능
- [x] 사용자별 폴더 구조
- [x] 치트시트 완료 팝업
- [ ] 더 다양한 의사 성격 옵션
- [ ] 진료 시나리오별 연습 모드
- [ ] 진료 결과 분석 및 피드백
- [ ] 모바일 앱 버전 개발

## 📄 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

---

**의료 진료 연습 시스템을 통해 효과적인 의사소통을 연습해보세요! 🏥✨** 